<form (ngSubmit)="onSubmit()" [formGroup]="form">

  <div class="filter-title bordered">
    <mat-form-field appearance="outline">
      <mat-label>Name</mat-label>
      <input formControlName="name" matInput>
    </mat-form-field>
  </div>

  <div class="add-button-container">
    <button (click)="addCriterion()" matButton="outlined" type="button">add criterion</button>
  </div>


  <div class="criterion-container" formArrayName="criteria">
    @for (criterion of criteria.controls; let idx = $index; track criterion.value.id) {

      <div class="criterion-item bordered" [formGroupName]="idx" [ngClass]="{'has-error': criterion.invalid}">
        <mat-form-field appearance="outline">
          <mat-select formControlName="type" (valueChange)="onTypeChange($event, idx)">
            <mat-option value="number">Number</mat-option>
            <mat-option value="string">String</mat-option>
            <mat-option value="date">Date</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="criterion-item-inner">
          @switch (criterion.controls.type.value) {
            @case ('number') {
              <app-amount-controls [group]="criterion"></app-amount-controls>
            }
            @case ('string') {
              <app-title-controls [group]="criterion"></app-title-controls>
            }
            @case ('date') {
              <app-date-controls [group]="criterion"></app-date-controls>
            }
          }
        </div>

        <button matMiniFab type="button" (click)="removeCriterion(idx)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    }
  </div>

</form>
